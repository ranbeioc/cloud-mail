import{aj as Z,ao as ee,ak as te,al as oe,af as le,z as w,D as L,$ as I,k as z,ay as se,c as u,f as r,g as n,aC as ae,i as re,N as P,e as V,t as i,O as A,ab as f,aD as ne,p as h,n as ie,m as b,P as K,h as M,aE as de,o as a,a7 as R,ap as x,an as c,aF as ue,aG as ce,ai as j}from"./index-UPLxqIys.js";/* empty css                  *//* empty css                 */import"./el-tag-Hztg23_E.js";import{E as pe,a as me}from"./el-select-CTEkc7WU.js";import"./el-scrollbar-Bfx33inu.js";import{a as ge,r as fe}from"./login-DqL6YmHN.js";import{i as G}from"./verify-utils-D6Av2NDy.js";import{I as J}from"./iconify-C7GRf3fV.js";import{_ as ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{E as ye}from"./vnode-ij9-6KPE.js";import{E as we}from"./index-CGMvl886.js";import"./index-B5f2hswV.js";import"./index-B8y37sFp.js";import"./index-CqrevvuG.js";import"./event-BB_Ol6Sd.js";const ke={id:"login-box"},Ve={key:0,id:"background-wrap"},he={class:"form-wrapper"},be={class:"container"},Se={class:"form-title"},$e={key:0,class:"form-desc"},Ee={key:1,class:"form-desc"},Me={style:{color:"var(--el-text-color-primary)"}},Ce=["data-sitekey"],Ue={key:0,style:{"font-size":"12px",color:"#F56C6C"}},_e={__name:"index",setup(Te){de(e=>({"3610c848":Q.value}));const{t:d}=Z(),q=ee(),H=te(),O=oe(),s=le(),C=w(!1),m=w("login"),v=L({email:"",password:""}),U=w(),p=w(""),l=L({email:"",password:"",confirmPassword:"",code:null}),_=s.domainList,E=w(!1);p.value=_[0];const S=w(!1);let $="",y=null,T=w(!1),D=0;window.onTurnstileSuccess=e=>{$=e},window.onTurnstileError=e=>{D>=4||(D++,console.warn("人机验加载失败",e),setTimeout(()=>{I(()=>{y?window.turnstile.reset(y):y=window.turnstile.render(".register-turnstile")})},1500))},window.loadAfter=e=>{console.log("loadAfter")},window.loadBefore=e=>{console.log("loadBefore")};const Q=z(()=>{const e=s.settings.loginOpacity;return O.dark?`rgba(0, 0, 0, ${e})`:`rgba(255, 255, 255, ${e})`}),W=z(()=>s.settings.background?{"background-image":`url(${se(s.settings.background)})`,"background-repeat":"no-repeat","background-size":"cover","background-position":"center"}:""),N=()=>{U.value.toggleMenu()},X=()=>{if(!v.email){c({message:d("emptyEmailMsg"),type:"error",plain:!0});return}let e=v.email+(s.settings.loginDomain===0?p.value:"");if(!G(e)){c({message:d("notEmailMsg"),type:"error",plain:!0});return}if(!v.password){c({message:d("emptyPwdMsg"),type:"error",plain:!0});return}C.value=!0,ge(e,v.password).then(async t=>{localStorage.setItem("token",t.token);const k=await ue();q.currentAccountId=k.accountId,H.user=k,ce(k.permKeys).forEach(g=>{j.addRoute("layout",g)}),await j.replace({name:"layout"}),O.showNotice()}).finally(()=>{C.value=!1})};function Y(){if(!l.email){c({message:d("emptyEmailMsg"),type:"error",plain:!0});return}if(!G(l.email+p.value)){c({message:d("notEmailMsg"),type:"error",plain:!0});return}if(!l.password){c({message:d("emptyPwdMsg"),type:"error",plain:!0});return}if(l.password.length<6){c({message:d("pwdLengthMsg"),type:"error",plain:!0});return}if(l.password!==l.confirmPassword){c({message:d("confirmPwdFailMsg"),type:"error",plain:!0});return}if(s.settings.regKey===0&&!l.code){c({message:d("emptyRegKeyMsg"),type:"error",plain:!0});return}if(!$&&(s.settings.registerVerify===0||s.settings.registerVerify===2&&s.settings.regVerifyOpen)){S.value?T.value||c({message:d("botVerifyMsg"),type:"error",plain:!0}):(S.value=!0,I(()=>{if(y)window.turnstile.reset(".register-turnstile");else try{y=window.turnstile.render(".register-turnstile")}catch{T.value=!0,console.log("人机验证js加载失败")}}));return}E.value=!0;const e={email:l.email+p.value,password:l.password,token:$,code:l.code};fe(e).then(({regVerifyOpen:t})=>{m.value="login",l.email="",l.password="",l.confirmPassword="",l.code="",E.value=!1,$="",s.settings.regVerifyOpen=t,S.value=!1,c({message:d("regSuccessMsg"),type:"success",plain:!0})}).catch(t=>{E.value=!1,t.code===400&&($="",s.settings.regVerifyOpen=!0,y?window.turnstile.reset(y):I(()=>{y=window.turnstile.render(".register-turnstile")}),S.value=!0)})}return(e,t)=>{const k=me,B=pe,g=ye,F=we;return a(),u("div",ke,[n(s).settings.background?(a(),u("div",{key:1,style:re(W.value)},null,4)):(a(),u("div",Ve,t[11]||(t[11]=[ae('<div class="x1 cloud" data-v-1de51574></div><div class="x2 cloud" data-v-1de51574></div><div class="x3 cloud" data-v-1de51574></div><div class="x4 cloud" data-v-1de51574></div><div class="x5 cloud" data-v-1de51574></div>',5)]))),r("div",he,[r("div",be,[r("span",Se,i(n(s).settings.title),1),m.value==="login"?(a(),u("span",$e,i(e.$t("loginTitle")),1)):(a(),u("span",Ee,i(e.$t("regTitle")),1)),P(r("div",null,[f(g,{class:ie(n(s).settings.loginDomain===0?"email-input":""),modelValue:v.email,"onUpdate:modelValue":t[1]||(t[1]=o=>v.email=o),type:"text",placeholder:e.$t("emailAccount"),autocomplete:"off"},ne({_:2},[n(s).settings.loginDomain===0?{name:"append",fn:h(()=>[r("div",{onClick:R(N,["stop"])},[m.value==="login"?(a(),b(B,{key:0,ref_key:"mySelect",ref:U,modelValue:p.value,"onUpdate:modelValue":t[0]||(t[0]=o=>p.value=o),placeholder:e.$t("select"),class:"select"},{default:h(()=>[(a(!0),u(K,null,x(n(_),o=>(a(),b(k,{key:o,label:o,value:o},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])):V("",!0),r("div",Me,[r("span",null,i(p.value),1),f(n(J),{class:"setting-icon",icon:"mingcute:down-small-fill",width:"20",height:"20"})])])]),key:"0"}:void 0]),1032,["class","modelValue","placeholder"]),f(g,{modelValue:v.password,"onUpdate:modelValue":t[2]||(t[2]=o=>v.password=o),placeholder:e.$t("password"),type:"password",autocomplete:"off"},null,8,["modelValue","placeholder"]),f(F,{class:"btn",type:"primary",onClick:X,loading:C.value},{default:h(()=>[M(i(e.$t("loginBtn")),1)]),_:1},8,["loading"])],512),[[A,m.value==="login"]]),P(r("div",null,[f(g,{class:"email-input",modelValue:l.email,"onUpdate:modelValue":t[4]||(t[4]=o=>l.email=o),type:"text",placeholder:e.$t("emailAccount"),autocomplete:"off"},{append:h(()=>[r("div",{onClick:R(N,["stop"])},[m.value!=="login"?(a(),b(B,{key:0,ref_key:"mySelect",ref:U,modelValue:p.value,"onUpdate:modelValue":t[3]||(t[3]=o=>p.value=o),placeholder:e.$t("select"),class:"select"},{default:h(()=>[(a(!0),u(K,null,x(n(_),o=>(a(),b(k,{key:o,label:o,value:o},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])):V("",!0),r("div",null,[r("span",null,i(p.value),1),f(n(J),{class:"setting-icon",icon:"mingcute:down-small-fill",width:"20",height:"20"})])])]),_:1},8,["modelValue","placeholder"]),f(g,{modelValue:l.password,"onUpdate:modelValue":t[5]||(t[5]=o=>l.password=o),placeholder:e.$t("password"),type:"password",autocomplete:"off"},null,8,["modelValue","placeholder"]),f(g,{modelValue:l.confirmPassword,"onUpdate:modelValue":t[6]||(t[6]=o=>l.confirmPassword=o),placeholder:e.$t("confirmPwd"),type:"password",autocomplete:"off"},null,8,["modelValue","placeholder"]),n(s).settings.regKey===0?(a(),b(g,{key:0,modelValue:l.code,"onUpdate:modelValue":t[7]||(t[7]=o=>l.code=o),placeholder:e.$t("regKey"),type:"text",autocomplete:"off"},null,8,["modelValue","placeholder"])):V("",!0),n(s).settings.regKey===2?(a(),b(g,{key:1,modelValue:l.code,"onUpdate:modelValue":t[8]||(t[8]=o=>l.code=o),placeholder:e.$t("regKeyOptional"),type:"text",autocomplete:"off"},null,8,["modelValue","placeholder"])):V("",!0),P(r("div",{class:"register-turnstile","data-sitekey":n(s).settings.siteKey,"data-callback":"onTurnstileSuccess","data-error-callback":"onTurnstileError","data-after-interactive-callback":"loadAfter","data-before-interactive-callback":"loadBefore"},[n(T)?(a(),u("span",Ue,i(e.$t("verifyModuleFailed")),1)):V("",!0)],8,Ce),[[A,S.value]]),f(F,{class:"btn",type:"primary",onClick:Y,loading:E.value},{default:h(()=>[M(i(e.$t("regBtn")),1)]),_:1},8,["loading"])],512),[[A,m.value!=="login"]]),n(s).settings.register===0?(a(),u(K,{key:2},[m.value==="login"?(a(),u("div",{key:0,class:"switch",onClick:t[9]||(t[9]=o=>m.value="register")},[M(i(e.$t("noAccount"))+" ",1),r("span",null,i(e.$t("regSwitch")),1)])):(a(),u("div",{key:1,class:"switch",onClick:t[10]||(t[10]=o=>m.value="login")},[M(i(e.$t("hasAccount"))+" ",1),r("span",null,i(e.$t("loginSwitch")),1)]))],64)):V("",!0)])])])}}},qe=ve(_e,[["__scopeId","data-v-1de51574"]]);export{qe as default};
